# Qdrive CAN通信协议

#### 波特率：`1Mbps`

## 控制报文

- 报文地址`0x400+ID`,其中`ID`范围`0x0~0xF`,单次报文长度`8`bytes

| bytes | 7  | 6  | 5-4  | 3-2  |  1   |  0   |
|:-----:|:--:|:--:|:----:|:----:|:----:|:----:|
|  说明   | ID | 预留 | 控制量2 | 控制量1 | 控制模式 | 指令类型 |

- 其中指令类型

| 指令类型 |       0x00       | 0x01 | 0x02 | 0x03 |  0x04  | 0x05 | 0x06 | 
|:----:|:----------------:|:----:|:----:|:----:|:------:|:----:|:----:|
|  说明  | NOP<br/>用于获取反馈报文 |  使能  |  失能  | 基础校准 | 齿槽转矩校准 | 运动控制 | 设置ID |

- 控制模式

| 控制模式 | 0x00 | 0x01 | 0x02 |
|:----:|:----:|:----:|:----:|
|  说明  | 电流控制 | 速度控制 | 角度控制 |

只有设置ID时采用到报文第七字节的ID

只有运动控制时才用到`控制模式`和`控制量`

目前只使用`控制量1`,控制量映射关系参考反馈报文

## 反馈报文

- 报文地址`0x500+ID`,单次报文长度`8`bytes
- 当收到控制报文后,电机发送一次反馈报文

| bytes |          7-6           |            5-4            |            3-2             |    1    |  0   |
|:-----:|:----------------------:|:-------------------------:|:--------------------------:|:-------:|:----:|
|  说明   | 角度 0~2pi<br/>映射到uint16 | 转速 -5k~5krpm<br/>映射到int16 | Q轴电流 -10A~10A<br/>映射到int16 | 错误码(预留) | 电机状态 |

- 其中电机状态

| bit | 7  | 6  | 5  | 4  |   3   |   2    | 1    |  0  |
|:---:|:--:|:--:|:--:|:--:|:-----:|:------:|------|:---:|
| 说明  | 预留 | 预留 | 预留 | 预留 | 应用抗齿槽 | 齿槽转矩校准 | 基础校准 | 使能位 |

- 校准时通信阻塞,请耐心等待校准完成
- 必须在电机失能时校准